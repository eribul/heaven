
* Introduction
** Overall Purpose
*** Register data preprocessing steps
 :PROPERTIES:
 :BEAMER_opt: shrink=9
 :END:

**** Input:  

=pop=, =lmdb=, =lpr=, =indh=, =dod=, =sogne= ...

**** Data preprocessing

code from hell, medicin macro, ...

**** Output:

#+ATTR_LaTeX: :align cccccm{2cm}m{2cm}
| Time 1 | Time 2 | Status | Age | Sex | Comorbidity in interval | Exposure in interval |
|--------+--------+--------+-----+-----+-------------------------+----------------------|
|        |        |        |     |     |                         |                      |


* SAS Interface

*** 

 
\vspace{2cm}

\LARGE\center{Existing SAS Interface}

\vspace{5cm}

** Input data
*** Input data
 :PROPERTIES:
 :BEAMER_opt: shrink=50
 :END:

**** Untitled: 
    :PROPERTIES:
    :BEAMER_col: 0.1
    :END:

**** Drug purchases: 

#+name: chunkdrugdb
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports results :results output   :session *R* :cache yes 
drugdata <- read.csv("~/research/Software/medicin-macro/test-sas/nov-23/recept_data.csv")
drugdata[1:8, -c(2, 5, 9)]
#+END_SRC

#+RESULTS[<2016-12-07 16:55:04> c801918b72e87f4c984e2694612bdc3dd3c9df75]:
:   atc       eksd  pnr strnum apk packsize
: 1  1a 2020-04-08 1000     75   3       20
: 2  1a 2011-10-30 1000    125   2        5
: 3  1a 2020-01-23 1000    125   1        5
: 4  1a 2015-09-17 1000     50   2       10
: 5  2a 2012-05-04 1000     50   3        5
: 6  2a 2011-10-11 1000     75   2        9
: 7  2a 2015-12-20 1000    125   1        9
: 8  2a 2015-10-27 1000    100   3       18

**** Untitled: 
    :PROPERTIES:
    :BEAMER_col: 0.1
    :END:

**** Admission dates: 

#+name: chunkadmdb
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports results :results output   :session *R* :cache yes 
datoer <- read.csv("~/research/Software/medicin-macro/test-sas/nov-23/datoer.csv")
rbindlist(lapply(1:dim(datoer)[1], function(i) {
    max <- datoer$max_indl[i]+1
    rows <- datoer[i, ]
    if (max < 4) {
        for (j in max:4) {
            rows[, j*2+1:2] <- NA
        }}
    return(rows)}))
#+END_SRC

#+RESULTS[<2016-12-07 17:00:41> 21d71be73e3ea194ecbc965462cfd382a1e224e5]:
:     pnr max_indl    inddto1     uddto1    inddto2     uddto2    inddto3     uddto3    inddto4     uddto4
: 1: 1000        3 2012-04-12 2012-04-25 2015-01-30 2015-02-14 2017-05-28 2017-05-31 2021-02-21 2021-03-08
: 2: 2000        2 2012-12-10 2012-12-15 2015-05-31 2015-06-05         NA         NA         NA         NA
: 3: 4000        1 2011-05-14 2011-05-23         NA         NA         NA         NA         NA         NA
: 4: 5000        4 2011-10-11 2011-10-13 2015-01-25 2015-02-01 2017-03-15 2017-03-23 2020-04-08 2020-04-21
: 5: 6000        1 2011-04-25 2011-04-30         NA         NA         NA         NA         NA         NA
: 6: 7000        1 2013-03-16 2013-03-21         NA         NA         NA         NA         NA         NA
: 7: 8000        4 2011-06-30 2011-07-02 2014-02-02 2014-02-07 2016-03-10 2016-03-23 2019-12-21 2019-12-28
: 8: 9000        4 2012-09-01 2012-09-14 2015-04-18 2015-05-03 2019-01-30 2019-02-12 2021-02-21 2021-02-27





*** Current interface (medicin macro)
 :PROPERTIES:
 :BEAMER_opt: shrink=55
 :END:

#+BEGIN_EXAMPLE
%x_recepter(recept_data, /* forventes at indeholde variable - skulle gerne passe med DST-standarder:
                                  pnr - cpr/patientidentifikation
                                  atc - ATC kode
                                  eksd - udleveringsdato som sas-dato
                                  strnum - numerisk styrke
                                  apk - antal udleverede pakker
                                  packsize - antal piller i hver pakke*/

                  datoer, /* Et produkt af medicin-hjælpe-macro eller andet program som ordner ALLE indlæggelser pr PNR på
                          EEN record med fortløbende inddto uddto */


                  out, /* tabel over behandlingsperioder - navn på SAS datasæt valgt af brugeren*/
                  1a, /* atc kode - den behandling som der skal beregnes på*/
                  5, /* antal recepter der indgår i beregninger - testet med 5, altså op til 2 før og 2 efter interesserecept */
                  50,  75, 100, 125, /* Doser svarende til de følgende variable - det er pillestørrelser
                         - her og de følgende variable skal ALLE have en værdi. Hvis der findes færre skal der blot gentages*/
                  10, 50, 25, 50,    /* Mindst accepterede dosis af lægemidler på hver pillestyrke*/
                  75, 200, 150, 150,    /* Max accepterede dosis*/
                  50, 100,  75, 100,    /* Typiske doser - en slags "default" dosis - og startdosis altid ved left_only */
                  10, /* Maximum sktørrelse af "restdosis" som kan overføres til følgende receptperioder. Denne giver mulighed for
                   at forhindre excessiv ophobning hvis små antagelser om maxdosis medfører til tiltagende stort depot
                   Max_depot er piller*styrke - Hvis der højst må gemmes 100 piller a 10 mg, så er max_depot 1000
                   */
                  '01sep12'd, /* første og sidste dato som har interesse kan angives som en "SAS-dato" eller med konventionen
                     'ddmmyy'd     */
                  '02may20'd,
                  1, /* Hvis værdien er 1 så kommer der tracking udskrift i loggen - hvis nul, så ikke. Tilsvarende slettes en række
                    temporære datasæt hvis værdien er 0 */
                  1, /* Hvis værdien er 1 så kommer der grafer */
                  test, /* præfix på generede variable som kan benyttes til at skelne fra lignende variable genereret i andre trin*/
                  1 /* danner tabeller "l_" hvor doser og sluttider KUN regnes bagud*/
                  );

#+END_EXAMPLE

** Output data
*** Output data
 :PROPERTIES:
 :BEAMER_opt: shrink=20
 :END:

Continuing example: 
#+name: chunksasout
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports results :results output   :session *R* :cache yes 
out_alt <- read.csv("~/research/Software/medicin-macro/test-sas/nov-23/out_alt.csv")
out_alt[1:15, ]
#+END_SRC

#+RESULTS[<2016-11-25 13:36:42> f8820f8e8040d1409c5c94203a90a25764125200]:
#+begin_example
    pnr dosis startdag slutdag
1  1000    50  17SEP15 06OCT15
2  1000   100  23JAN20 28JAN20
3  1000   100  08APR20 22MAY20
4  2000    20  15MAY13 05AUG13
5  2000    75  04NOV15 16NOV15
6  2000   100  15MAR17 21MAY17
7  3000   100  16MAR13 21MAR13
8  3000   100  26APR13 02MAY13
9  3000    50  10MAR16 08MAY16
10 3000    75  04JAN19 16JAN19
11 3000   100  14JUL19 04AUG19
12 3000   150  05AUG19 16AUG19
13 3000    75  17AUG19 22AUG19
14 3000    50  01NOV19 19NOV19
15 3000    75  20NOV19 16DEC19
#+end_example

** Immediate limitations
*** Immediate limitations

- Speed
  + Each drug must be processed separately, repeating the macro call
\vspace{0.2cm}
- Lack of transparency
  + Mathematical formulas? 
\vspace{0.2cm}
- Other issues:  
  + Dependence on the future
  + Only possible to specify four different doses
  + Graphical checks (working?)? 

 
* New R Interface 

*** 
\vspace{2cm}

\LARGE\center{New R Interface}

\vspace{5cm}


*** Addressing the issues in SAS
 :PROPERTIES:
 :BEAMER_opt: shrink=10
 :END:

- Speed
  + We use the ~Rcpp~ to integrate ~C++~-code directly in ~R~

\vspace{0.2cm}
- Lack of transparency
  + We have written up all steps in the macro explicitly 
  + Everything is collected in a documentation article 

\vspace{0.2cm}
- New interface
  - Object oriented coding for more effiency
  - Visualization tools to plot input data and output estimates
  - Accessed via ~R~-package ~heaven~ (github) 

\vspace{0.1cm}
In ~R~ the package is installed via: 
#+name: chunkgithub
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
devtools::install_github("tagteam/heaven")
#+END_SRC

#+RESULTS[<2016-12-07 17:00:42> 6a5cc8e079da9ffff7ca9d74491fb05b1fae0a96]:
: Skipping install of 'heaven' from a github remote, the SHA1 (183e8600) has not changed since last install.
:   Use `force = TRUE` to force installation

\vspace{0.1cm}
Intro to ~R~-packages: http://r-pkgs.had.co.nz/ \\
How to use Git in Rstudio: http://r-pkgs.had.co.nz/git.html



*** New R interface
 :PROPERTIES:
 :BEAMER_opt: shrink=20
 :END:

\vspace{0.2cm}

- Same input data sets as before (almost)
  + Admission dates data set long format
\vspace{0.2cm}

#+name: chunkadmdb
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports results :results output   :session *R* :cache yes 
library(heaven)
set.seed(8)
drugdata <- simPrescriptionData(10)
admdata <- simAdmissionData(10)
admdata[1:5, ]
#+END_SRC

#+RESULTS[<2016-12-01 11:19:45> 314398f64b6e1a21d5911ae2525affb8a1bcafd5]:
:    pnr     inddto      uddto
: 1:   1 2003-12-20 2003-12-24
: 2:   1 2006-07-20 2006-09-01
: 3:   1 2007-04-30 2007-05-15
: 4:   1 2010-11-27 2011-01-02
: 5:   1 2013-05-11 2013-05-16
...
 \vspace{0.1cm}

- Attach relevant data (more user details in a moment)


\vspace{0.2cm}

#+BEGIN_SRC R :results output :exports code  :session *R* :width 6 :height 4 :cache yes
drugdb(d) <- drugdata
admdb(d) <- admdata
#+END_SRC

#+RESULTS[<2016-12-07 17:00:42> 29eb09f561f642d4d7824b33d9fe50a1930c85c3]:

\vspace{0.1cm}
- ~plot()~-function to show purchases and admission periods 
\vspace{0.2cm}

#+BEGIN_SRC R :results output :exports code  :session *R* :width 6 :height 4 :cache yes
plot(d)
#+END_SRC

#+RESULTS[<2016-12-07 17:00:43> a90a4182ffe973369bd89f7ca501251dbc596040]:


** Visualization tools
*** Input visualization tools
 :PROPERTIES:
 :BEAMER_opt: shrink=10
 :END:



\vspace{0.5cm}

#+BEGIN_SRC R :results graphics :file "./drug-fig-1.pdf" :exports none  :session *R* :width 6 :height 4 :cache yes
library(heaven)
set.seed(8)
drugdata <- simPrescriptionData(10)
admdata <- simAdmissionData(10)
d <- dpp()
drugdb(d) <- drugdata
admdb(d) <- admdata
plot(d)
#+END_SRC

#+RESULTS[<2016-11-25 15:16:07> 6d438e77e7e2239ef66d5e5f32ac3aa589de69c3]:
[[file:./drug-fig-1.pdf]]

#+LABEL: fig:ex1
#+ATTR_LATEX: :width 1 \textwidth
[[file:./drug-fig-1.pdf]]

** User details 
*** How to use the interface
 :PROPERTIES:
 :BEAMER_opt: shrink=20
 :END:

\noindent Load package: 
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
library(heaven)
#+END_SRC

#+RESULTS[<2016-12-07 17:00:43> 71045dfd56a538f10da541e7332fc05169b0bb79]:

\noindent Create empty object: 
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
d <- dpp()
#+END_SRC

#+RESULTS[<2016-12-07 17:00:43> 0becf5c9f492bec7c09e718e56c90f3dc9598b29]:

\noindent Attach relevant data: 
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
drugdb(d) <- drugdata
admdb(d) <- admissiondata
#+END_SRC

#+RESULTS[<2016-12-07 17:00:43> 0cc8a2499ccc7a633f2cd2a812a5342678f7fe63]:
: Error: object 'admissiondata' not found

\noindent Add treatments: 
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
drug(d, "treatment1") <- atc("A12B")
drug(d, "treatment1") <- pack(c(750, 75), 
                              min = c(250, 25), 
                              max = c(1000, 100), 
                              def = c(750, 100))
#+END_SRC

#+RESULTS[<2016-12-07 17:00:43> aa1b8316ab44910256767ed649adf78ef0fed9cd]:

\noindent Specify window of prescription dates to use in calculations: 
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
pwindow(d) <- 3 ## include data from up to 3 previous purchase dates into the calculation of the daily dosis 
#+END_SRC

#+RESULTS[<2016-12-07 17:00:43> 82facfcd96524d7c4ecec773e7a1d93b50a78935]:


*** How to use the interface
 :PROPERTIES:
 :BEAMER_opt: shrink=20
 :END:

\noindent When everything is specified, we perform the calculations by
running:
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
process(d)
#+END_SRC

#+RESULTS[<2016-12-07 17:00:43> e732c4f345d319fe197118bab1382675aa9c253d]:
: Error in innerprocess(dat, admdat, doses, treatname, dpp$N, maxdepot,  : 
:   index out of bounds

#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports results :results output   :session *R* :cache yes 
library(heaven)
library(Publish)
set.seed(8)
drugdata <- simPrescriptionData(10)
admdata <- simAdmissionData(10)
d <- dpp()
drugdb(d) <- drugdata
admdb(d) <- admdata
drug(d, "treatment1") <- atc("A12B")
drug(d, "treatment1") <- pack(c(750, 75), 
                            min = c(250, 25), 
                            max = c(1000, 100), 
                            def = c(750, 100))
pwindow(d) <- 3
out <- process(d)
out[1]
#+END_SRC

#+RESULTS[<2016-11-28 10:07:13> 254d6ef36671f34746b2181f5e1ffc27c1ba2743]:
#+begin_example
$treatment1
   id   X          B          E
1   1 100 1997-08-21 2007-11-26
2   2 100 1995-09-09 2030-02-05
3   3 100 1995-06-21 1997-08-12
4   3   0 1997-08-13 1998-02-21
5   3 100 1998-02-22 2010-02-08
6   4 100 1995-01-01 2030-08-17
7   5 100 1995-02-14 1996-02-23
8   5   0 1996-02-24 1996-04-25
9   5  75 1996-04-26 1997-08-20
10  5 100 1997-08-21 2000-03-01
11  6 100 1995-01-01 1995-03-16
12  6   0 1995-03-17 1995-09-23
13  6  25 1995-09-24 1996-05-04
14  6 100 1996-05-05 2015-01-26
15  7 100 1995-06-27 1999-09-16
16  8 100 1996-09-26 2009-08-27
17  9 100 1995-05-09 1999-06-18
18  9   0 1999-06-19 1999-11-18
19  9 100 1999-11-19 2001-06-03
20 10 100 1995-09-13 2014-04-21
#+end_example



*** How to use the interface
 :PROPERTIES:
 :BEAMER_opt: shrink=20
 :END:

\noindent We may add treaments:
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
drug(d, "treatment2") <- atc("A07")
drug(d, "treatment2") <- pack(c(200, 400, 500), 
                     min = c(100, 100, 250),
                     max = c(400, 500, 1000), 
                     def = c(300, 200, 500))
#+END_SRC

#+RESULTS[<2016-12-07 17:00:43> 85f68d36d96d0ffab09561f04407c8a171ff1f5b]:

\noindent And then perform calculations again: 
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
process(d)
#+END_SRC

#+RESULTS[<2016-12-07 17:00:43> e732c4f345d319fe197118bab1382675aa9c253d]:
: Error in innerprocess(dat, admdat, doses, treatname, dpp$N, maxdepot,  : 
:   index out of bounds

#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports results :results output   :session *R* :cache yes 
library(heaven)
library(Publish)
set.seed(8)
drugdata <- simPrescriptionData(10)
admdata <- simAdmissionData(10)
d <- dpp()
drugdb(d) <- drugdata
admdb(d) <- admdata
drug(d, "treatment1") <- atc("A12B")
drug(d, "treatment1") <- pack(c(750, 75), 
                            min = c(250, 25), 
                            max = c(1000, 100), 
                            def = c(750, 100))
drug(d, "treatment2") <- atc("A07")
drug(d, "treatment2") <- pack(c(200, 400, 500), 
                     min = c(100, 100, 250),
                     max = c(400, 500, 1000), 
                     def = c(300, 200, 500))
pwindow(d) <- 3
out <- process(d)
lapply(out[1:2], head)
#+END_SRC

#+RESULTS[<2016-11-28 10:09:02> b087ff44e2c3049b4e5617354237a8df293fe61a]:
#+begin_example
$treatment1
  id   X          B          E
1  1 100 1997-08-21 2007-11-26
2  2 100 1995-09-09 2030-02-05
3  3 100 1995-06-21 1997-08-12
4  3   0 1997-08-13 1998-02-21
5  3 100 1998-02-22 2010-02-08
6  4 100 1995-01-01 2030-08-17

$treatment2
  id   X          B          E
1  1 200 1996-06-15 1996-08-13
2  1   0 1996-08-14 1997-04-13
3  1 500 1997-04-14 1997-06-12
4  1   0 1997-06-13 1998-03-22
5  1 200 1998-03-23 1998-07-20
6  1   0 1998-07-21 1998-11-04
#+end_example


*** How to use the interface
 :PROPERTIES:
 :BEAMER_opt: shrink=20
 :END:


\noindent The function can be used treatment and/or id speficic:
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
process(d, treatment = "treatment2")
#+END_SRC

#+RESULTS[<2016-12-07 17:00:43> b8f86fc8ed8f1f3648a3b0541b67e41b8a0c9255]:
: Error in innerprocess(dat, admdat, doses, treatname, dpp$N, maxdepot,  : 
:   index out of bounds

#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports results :results output   :session *R* :cache yes 
library(heaven)
library(Publish)
set.seed(8)
drugdata <- simPrescriptionData(10)
admdata <- simAdmissionData(10)
d <- dpp()
drugdb(d) <- drugdata
admdb(d) <- admdata
drug(d, "treatment1") <- atc("A12B")
drug(d, "treatment1") <- pack(c(750, 75), 
                            min = c(250, 25), 
                            max = c(1000, 100), 
                            def = c(750, 100))
drug(d, "treatment2") <- atc("A07")
drug(d, "treatment2") <- pack(c(200, 400, 500), 
                     min = c(100, 100, 250),
                     max = c(400, 500, 1000), 
                     def = c(300, 200, 500))
pwindow(d) <- 3
out <- process(d, treatment = "treatment2")
lapply(out[1], head)
#+END_SRC

#+RESULTS[<2016-11-28 10:16:07> 2be524535c80c33de7a9e484ffb9036c05739ed6]:
: $treatment2
:   id   X          B          E
: 1  1 200 1996-06-15 1996-08-13
: 2  1   0 1996-08-14 1997-04-13
: 3  1 500 1997-04-14 1997-06-12
: 4  1   0 1997-06-13 1998-03-22
: 5  1 200 1998-03-23 1998-07-20
: 6  1   0 1998-07-21 1998-11-04


#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
process(d, id = 9)
#+END_SRC

#+RESULTS[<2016-12-07 17:00:43> 9bce188b84dbed3b40bd044ade149c35ffdfca91]:
: Error in innerprocess(dat, admdat, doses, treatname, dpp$N, maxdepot,  : 
:   index out of bounds

#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports results :results output   :session *R* :cache yes 
library(heaven)
library(Publish)
set.seed(8)
drugdata <- simPrescriptionData(10)
admdata <- simAdmissionData(10)
d <- dpp()
drugdb(d) <- drugdata
admdb(d) <- admdata
drug(d, "treatment1") <- atc("A12B")
drug(d, "treatment1") <- pack(c(750, 75), 
                            min = c(250, 25), 
                            max = c(1000, 100), 
                            def = c(750, 100))
drug(d, "treatment2") <- atc("A07")
drug(d, "treatment2") <- pack(c(200, 400, 500), 
                     min = c(100, 100, 250),
                     max = c(400, 500, 1000), 
                     def = c(300, 200, 500))
pwindow(d) <- 3
out <- process(d, id = 9)
out[1:2]
#+END_SRC

#+RESULTS[<2016-11-28 10:34:20> 9d691c83c775f7d74f6bd237dcf584e7a0cbc940]:
#+begin_example
$treatment1
  id   X          B          E
1  9 100 1995-05-09 1999-06-18
2  9   0 1999-06-19 1999-11-18
3  9 100 1999-11-19 2001-06-03

$treatment2
  id   X          B          E
1  9 200 1996-02-22 1996-04-08
2  9 500 1996-04-09 1996-05-26
3  9   0 1996-05-27 1998-05-22
4  9 300 1998-05-23 1998-06-11
5  9   0 1998-06-12 1999-11-21
6  9 500 1999-11-22 2000-09-16
#+end_example

*** Built-in tools for output visulizations
 :PROPERTIES:
 :BEAMER_opt: shrink=10
 :END:

A ~plot()~-function to visualize the output:
\\

\vspace{0.2cm}

#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
out <- process(d)
plot(out, id = 1)
#+END_SRC

#+RESULTS[<2016-12-07 17:04:10> 5f72f7e123bcdd55714a8eb041d0eb1052ae6820]:


#+BEGIN_SRC R :results graphics :file "./drug-fig-2.pdf" :exports none  :session *R* :width 6 :height 4 :cache yes
library(heaven)
library(Publish)
set.seed(8)
drugdata <- simPrescriptionData(10)
admdata <- simAdmissionData(10)
d <- dpp()
setwd("~/research/Software/medicin-macro/heaven/worg")
drugdb(d) <- drugdata
admdb(d) <- admdata
drug(d, "treatment1") <- atc("A12B")
drug(d, "treatment1") <- pack(c(750, 75), 
                            min = c(250, 25), 
                            max = c(1000, 100), 
                            def = c(750, 100))
drug(d, "treatment2") <- atc("A07")
drug(d, "treatment2") <- pack(c(200, 400, 500), 
                     min = c(100, 100, 250),
                     max = c(400, 500, 1000), 
                     def = c(300, 200, 500))
pwindow(d) <- 3
out <- process(d)
plot(out, id = 1)
#+END_SRC


#+RESULTS[<2016-12-07 17:04:29> 05d37ef019cf7f46332ac720c16993a81e1a1887]:
[[file:./drug-fig-2.pdf]]



#+LABEL: fig:ex2
#+ATTR_LATEX: :width 1 \textwidth
file:./drug-fig-2.pdf

** Technical details
*** Technical details 
 :PROPERTIES:
 :BEAMER_opt: shrink=20
 :END:


\vspace{0.1cm}
... the mathematical part ... \\

\vspace{0.2cm}
- \noindent The ~R~-interface and the following formulas are all based
  on the implementation of ~medicin macro~ (~left_only~).
\vspace{0.05cm}
- The computations performed consists basically of an averaging over a
  set of prescriptions back in time (decided by the user)
\vspace{0.05cm}
- A number of things will for each prescription date help us determine how
  many dates back in time we should use for the calculations:
 
  - The number of days of supply of a certain drug is calculated based on
    the minimal possible doses for a drug
  - The actual number of dates between the prescription periods (where
    the number of days hospitalized is subtracted)
  - Whether or not the total amount of drug purchased at time \(k\) is
    approximately the same as purchased at earlier times
\vspace{0.05cm}
- Exposure periods are then calculated based on these average dose
  amounts


*** Final formula (a  snippet of what we have worked on)
 :PROPERTIES:
 :BEAMER_opt: shrink=40
 :END:



**** Untitled column
    :PROPERTIES:
    :BEAMER_col: 1.0
    :END:

\begin{align} 
          &{X}_{k} =  (1-u_{k-1}) \, \styp_{b(k)}\tag{No overlap}\\
	  &+ \, u_{k-1} \bigg[\tag{Overlap}
          \\ \begin{split}
 & \qquad   1\Big\lbrace S_{b(k-1)}= S_{b(k)}\Big\rbrace\bigg( \one \left\lbrace W_k > \smax_{b(k)}\right\rbrace \smax_{b(k)}
\\ & \qquad + \one \left\lbrace W_k < \smin_{b(k)}\right\rbrace \smin_{b(k)} 
\\& \qquad + \one \left\lbrace W_k \le \smax_{b(k)}\right\rbrace \one \left\lbrace W_k \ge \smin_{b(k)}\right\rbrace W_k\bigg) \bigg].
\end{split}\tag{I}
	  \\
\begin{split}
 & \qquad +  1\Big\lbrace S_{b(k-1)}\neq S_{b(k)}\Big\rbrace\bigg( \one \left\lbrace M^{(2)}_k > \smax_{b(k)}\right\rbrace \smax_{b(k)}
\\ & \qquad + \one \left\lbrace M^{(2)}_k < \smin_{b(k)}\right\rbrace \smin_{b(k)} 
\\& \qquad + \one \left\lbrace M^{(2)}_k \le \smax_{b(k)}\right\rbrace \one \left\lbrace M^{(2)}_k \ge \smin_{b(k)}\right\rbrace \styp_{b(k)}\bigg) \bigg].
\end{split}\tag{II}
\end{align}

**** Untitled column
    :PROPERTIES:
    :BEAMER_col: 0.1
    :END:

**** Untitled column
    :PROPERTIES:
    :BEAMER_col: 0.6
    :END:


 \(M_k^{(1)},\, M_k^{(2)}\) are average doses \color{red}over the periods \\
\vspace{0.4cm}
\color{black}

  \(W_k\) is a rounding of \(M_k^{(1)}\) to nearest multiple of relevant minimal dose

#+BEGIN_SRC R :results graphics :file "./drug-small-fig.pdf" :exports none  :session *R* :width 4 :height 1 :cache yes
par(mar=c(2.1,2.1,0.1,2.1))
plot(0,0,type="n",xlim=c(0,100),ylim=c(0,100),xlab="",ylab="", 
     yaxt='n', xaxt='n', axes=FALSE)
axis(1,at=c(0, 25, 40, 75, 100),labels=c("", expression(3~s[min]), 
                                 expression(M[k]^{(1)}), expression(4~s[min]), ""))
#+END_SRC


#+RESULTS[<2016-12-07 17:00:44> f77cda134848f2834055663ea24b2f8a9d0314f3]:
[[file:./drug-small-fig.pdf]]

#+LABEL: fig:ex2
#+ATTR_LATEX: :width 1 \textwidth
# file:./drug-small-fig.pdf


**** Back to no columns 
    :PROPERTIES:
    :BEAMER_env: ignoreheading
    :END:

**** Untitled column
    :PROPERTIES:
    :BEAMER_col: 0.1
    :END:

**** Untitled column
    :PROPERTIES:
    :BEAMER_col: 1.3
    :END:

#+LABEL: fig:periods
#+ATTR_LATEX: :width 0.8 \textwidth
file:./drug-dat2a.pdf



*** More output visulizations
 :PROPERTIES:
 :BEAMER_opt: shrink=10
 :END:

We may also take a closer view on the underlying purchases behind the
final exposures estimated: \\

\vspace{0.2cm}

#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
out1 <- process(d, keep_data = TRUE)
plot(out1, id = 5, trace = TRUE)
#+END_SRC

#+RESULTS[<2016-12-07 17:00:44> 259c51ed0fc6b89bfa6b5367f05ef123bde1c57e]:
:  X11cairo 
:        2
: Error in innerprocess(dat, admdat, doses, treatname, dpp$N, maxdepot,  : 
:   index out of bounds
: Error in plot(out1, id = 5, trace = TRUE) : object 'out1' not found

#+BEGIN_SRC R :results graphics :file "./drug-fig-3.pdf" :exports none  :session *R* :width 6 :height 4
library(heaven)
library(Publish)
set.seed(8)
drugdata <- simPrescriptionData(10)
admdata <- simAdmissionData(10)
d <- dpp()
drugdb(d) <- drugdata
admdb(d) <- admdata
drug(d, "treatment1") <- atc("A12B")
drug(d, "treatment1") <- pack(c(750, 75), 
                            min = c(250, 25), 
                            max = c(1000, 100), 
                            def = c(750, 100))
drug(d, "treatment2") <- atc("A07")
drug(d, "treatment2") <- pack(c(200, 400, 500), 
                     min = c(100, 100, 250),
                     max = c(400, 500, 1000), 
                     def = c(300, 200, 500))
pwindow(d) <- 3
out1 <- process(d, keep_data = TRUE)
plot(out1, id = 5, trace = TRUE)+theme(legend.title=element_text(size=8),legend.text=element_text(size=6))
#+END_SRC

#+RESULTS[<2016-11-28 11:28:39> 593c3dd58559e92e0369d635626bf6d33fa9c6b8]:
[[file:./drug-fig-3.pdf]]


#+LABEL: fig:ex3
#+ATTR_LATEX: :width .9 \textwidth
file:./drug-fig-3.pdf







* Real Example
*** Example: Omeprazol
 :PROPERTIES:
 :BEAMER_opt: shrink=30
 :END:

**** Untitled: 
    :PROPERTIES:
    :BEAMER_col: 0.1
    :END:

**** Drug purchases: 
    :PROPERTIES:
    :BEAMER_col: 0.9
    :BEAMER_env: block
    :END:
#+name: chunkex1
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports results :results output :session *R* :cache yes 
PPI <- read.table("~/research/Software/medicin-macro/heaven/data/samplePPIData.csv", header=TRUE, sep=";")
PPI
#+END_SRC


#+RESULTS[<2016-11-30 13:54:10> 77d7157c5d5ddf50db00ace8f89bcb7493c026df]:
#+begin_example
   pnr       eksd packsize strnum apk     atc
1    1 25/01/2011       56     40   1 A02BC02
2    1 29/10/2012      100     40   1 A02BC02
3    1 31/07/2012      100     40   1 A02BC02
4    1 12/09/2011       28     40   1 A02BC02
5    1 24/10/2011       28     40   1 A02BC02
6    1 03/02/2011       56     40   1 A02BC02
7    1 09/12/2010       56     40   1 A02BC02
8    1 02/11/2010       56     40   1 A02BC02
9    1 04/04/2012       98     40   1 A02BC02
10   1 30/01/2012       98     40   1 A02BC02
11   1 22/06/2011       98     40   1 A02BC02
12   1 17/03/2011       98     40   1 A02BC02
#+end_example

**** Untitled: 
    :PROPERTIES:
    :BEAMER_col: 0.1
    :END:

**** Admission dates: 
    :PROPERTIES:
    :BEAMER_col: 0.6
    :BEAMER_env: block
    :END:
#+name: chunkex1
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports results :results output :session *R* :cache yes 
admData <- data.frame(inddto = sapply(c("2004-01-20", "2004-01-22", "2006-06-20", "2006-06-23", "2010-01-21",
                                       "2010-01-14", "2010-01-26", "2010-07-05", "2010-10-21", "2011-07-14",
                                       "2011-12-01", "2011-12-14", "2011-12-25", "2011-12-29"), as.Date),
                      uddto  = sapply(c("2004-01-20", "2004-01-23", "2006-06-20", "2006-06-23", "2010-01-20",
                                       "2010-01-26", "2010-02-10", "2010-07-05", "2010-10-29", "2011-07-16",
                                       "2011-12-14", "2011-12-25", "2011-12-29", "2012-01-16"), as.Date))
admData
#+END_SRC

#+RESULTS[<2016-11-30 13:53:58> 89d987e88d7696fb0cd5dfa0742c651498843033]:
#+begin_example
           inddto uddto
2004-01-20  12437 12437
2004-01-22  12439 12440
2006-06-20  13319 13319
2006-06-23  13322 13322
2010-01-21  14630 14629
2010-01-14  14623 14635
2010-01-26  14635 14650
2010-07-05  14795 14795
2010-10-21  14903 14911
2011-07-14  15169 15171
2011-12-01  15309 15322
2011-12-14  15322 15333
2011-12-25  15333 15337
2011-12-29  15337 15355
#+end_example

**** Plotting the data:  

#+BEGIN_SRC R :results output raw drawer  :exports none :session *R* :cache yes 
setwd("~/research/Software/medicin-macro/heaven/worg")
#+END_SRC

#+RESULTS[<2016-12-07 17:00:44> 7a9382967fcbd16a0590961f779a8d4282210926]:
:RESULTS:
 X11cairo 
       2
:END:

#+BEGIN_SRC R :results graphics :file "./drug-fig-ex-1.pdf" :exports none  :session *R* :width 6 :height 2
admData <- data.frame(inddto = sapply(c("2004-01-20", "2004-01-22", "2006-06-20", "2006-06-23", "2010-01-21",
                                       "2010-01-14", "2010-01-26", "2010-07-05", "2010-10-21", "2011-07-14",
                                       "2011-12-01", "2011-12-14", "2011-12-25", "2011-12-29"), as.Date),
                      uddto  = sapply(c("2004-01-20", "2004-01-23", "2006-06-20", "2006-06-23", "2010-01-20",
                                       "2010-01-26", "2010-02-10", "2010-07-05", "2010-10-29", "2011-07-16",
                                       "2011-12-14", "2011-12-25", "2011-12-29", "2012-01-16"), as.Date))
admData$pnr <- rep(1, dim(admData)[1])
admData$inddto <- as.Date(admData$inddto, origin="1970-01-01")
admData$uddto <- as.Date(admData$uddto, origin="1970-01-01")
library(heaven)
PPI <- read.table("../data/samplePPIData.csv", header=TRUE, sep=";")
PPI$eksd <- as.Date(PPI$eksd, format="%d/%m/%Y")
d <- dpp()
drugdb(d) <- PPI
admdb(d) <- admData

drug(d, "omeprazol") <- atc("A02BC02")
drug(d, "omeprazol") <- pack(c(10, 20, 40, 40),
                             min = c(10, 20, 40, 40),
                             max = c(20, 40, 60, 80),
                             def = c(10, 20, 40, 40))

period(d) <- sapply(c("1997-01-01", "2012-12-31"), as.Date)

maxdepot(d) <- 4000

plot(d)
#+END_SRC

#+RESULTS[<2016-11-28 11:28:39> 593c3dd58559e92e0369d635626bf6d33fa9c6b8]:
[[file:./drug-fig-ex-1.pdf]]

#+LABEL: fig:ex1-1
#+ATTR_LATEX: :width 1 \textwidth
[[file:./drug-fig-ex-1.pdf]]


*** Example: Omeprazol
 :PROPERTIES:
 :BEAMER_opt: shrink=55
 :END:

\LARGE{Using medicin-macro:}

#+BEGIN_EXAMPLE
%x_recepter(PPI, /* forventes at indeholde variable - skulle gerne passe med DST-standarder:
                                  pnr - cpr/patientidentifikation
                                  atc - ATC kode
                                  eksd - udleveringsdato som sas-dato
                                  strnum - numerisk styrke
                                  apk - antal udleverede pakker
                                  packsize - antal piller i hver pakke*/

                  admData, /* Et produkt af medicin-hjælpe-macro eller andet program som ordner ALLE indlæggelser pr PNR på
                          EEN record med fortløbende inddto uddto */


                  omeprazol, /* tabel over behandlingsperioder - navn på SAS datasæt valgt af brugeren*/
                  A02BC02, /* atc kode - den behandling som der skal beregnes på*/
                  5, /* antal recepter der indgår i beregninger - testet med 5, altså op til 2 før og 2 efter interesserecept */
                  10, 20, 40, 40, /* Doser svarende til de følgende variable - det er pillestørrelser
                         - her og de følgende variable skal ALLE have en værdi. Hvis der findes færre skal der blot gentages*/
                  10, 20, 40, 40,    /* Mindst accepterede dosis af lægemidler på hver pillestyrke*/
                  20, 40, 60, 80,    /* Max accepterede dosis*/
                  10, 20, 40, 40,    /* Typiske doser - en slags "default" dosis - og startdosis altid ved left_only */
                  4000, /* Maximum sktørrelse af "restdosis" som kan overføres til følgende receptperioder. Denne giver mulighed for
                   at forhindre excessiv ophobning hvis små antagelser om maxdosis medfører til tiltagende stort depot
                   Max_depot er piller*styrke - Hvis der højst må gemmes 100 piller a 10 mg, så er max_depot 1000
                   */
                  '01jan1997'd, /* første og sidste dato som har interesse kan angives som en "SAS-dato" eller med konventionen
                     'ddmmyy'd     */
                  '31dec2012'd,
                  1, /* Hvis værdien er 1 så kommer der tracking udskrift i loggen - hvis nul, så ikke. Tilsvarende slettes en række
                    temporære datasæt hvis værdien er 0 */
                  1, /* Hvis værdien er 1 så kommer der grafer */
                  test, /* præfix på generede variable som kan benyttes til at skelne fra lignende variable genereret i andre trin*/
                  1 /* danner tabeller "l_" hvor doser og sluttider KUN regnes bagud*/
                  );
#+END_EXAMPLE


*** Example: Omeprazol
 :PROPERTIES:
 :BEAMER_opt: shrink=20
 :END:

#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
library(heaven)

d <- dpp()
drugdb(d) <- PPI
admdb(d) <- admData

drug(d, "omeprazol") <- atc("A02BC02")
drug(d, "omeprazol") <- pack(c(10, 20, 40, 40),
                             min = c(10, 20, 40, 40),
                             max = c(20, 40, 60, 80),
                             def = c(10, 20, 40, 40))

period(d) <- sapply(c("1997-01-01", "2012-12-31"), as.Date)
pwindow(d) <- 2
maxdepot(d) <- 4000

process(d)
#+END_SRC

#+RESULTS[<2016-12-07 17:00:44> d44b3e41af36a86ed059b80b506cd3303010f946]:
#+begin_example
 X11cairo 
       2
$omeprazol
  id  X          B          E
1  1 40 2010-11-02 2010-12-08
2  1 80 2010-12-09 2011-10-09
3  1  0 2011-10-10 2011-10-23
4  1 80 2011-10-24 2011-11-20
5  1  0 2011-11-21 2012-01-29
6  1 40 2012-01-30 2012-04-03
7  1 80 2012-04-04 2013-02-05

attr(,"out_data")
[1] TRUE
attr(,"period")
1997-01-01 2012-12-31 
      9862      15705 
attr(,"class")
[1] "dppout"
#+end_example


#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports results :results output   :session *R* :cache yes 
admData <- data.frame(inddto = sapply(c("2004-01-20", "2004-01-22", "2006-06-20", "2006-06-23", "2010-01-21",
                                       "2010-01-14", "2010-01-26", "2010-07-05", "2010-10-21", "2011-07-14",
                                       "2011-12-01", "2011-12-14", "2011-12-25", "2011-12-29"), as.Date),
                      uddto  = sapply(c("2004-01-20", "2004-01-23", "2006-06-20", "2006-06-23", "2010-01-20",
                                       "2010-01-26", "2010-02-10", "2010-07-05", "2010-10-29", "2011-07-16",
                                       "2011-12-14", "2011-12-25", "2011-12-29", "2012-01-16"), as.Date))

admData$pnr <- rep(1, dim(admData)[1])
admData$inddto <- as.Date(admData$inddto, origin="1970-01-01")
admData$uddto <- as.Date(admData$uddto, origin="1970-01-01")
library(heaven)
PPI <- read.table("~/research/Software/medicin-macro/heaven/data/samplePPIData.csv", header=TRUE, sep=";")
PPI$eksd <- as.Date(PPI$eksd, format="%d/%m/%Y")
d <- dpp()
drugdb(d) <- PPI
admdb(d) <- admData
drug(d, "omeprazol") <- atc("A02BC02")
drug(d, "omeprazol") <- pack(c(10, 20, 40, 40),
                             min = c(10, 20, 40, 40),
                             max = c(20, 40, 60, 80),
                             def = c(10, 20, 40, 40))
period(d) <- sapply(c("1997-01-01", "2012-12-31"), as.Date)

maxdepot(d) <- 4000

(out <- process(d))
#+END_SRC

#+RESULTS[<2016-11-30 14:28:50> cddab33e5a3bc207749fcedd77700a602c15c440]:
#+begin_example
$omeprazol
  id  X          B          E
1  1 40 2010-11-02 2010-12-08
2  1 80 2010-12-09 2011-10-09
3  1  0 2011-10-10 2011-10-23
4  1 80 2011-10-24 2011-11-20
5  1  0 2011-11-21 2012-01-29
6  1 40 2012-01-30 2012-04-03
7  1 80 2012-04-04 2013-02-05
#+end_example



*** Example: Omeprazol
 :PROPERTIES:
 :BEAMER_opt: shrink=20
 :END:

Plotting output: 
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
out <- process(d)
plot(out)
#+END_SRC

#+RESULTS[<2016-11-30 14:34:36> 53f8f9bc7f987b81c079e4204c05ed7dd95382a6]:


#+BEGIN_SRC R :results graphics :file "./drug-fig-ex-2.pdf" :exports none  :session *R* :width 8 :height 6
admData <- data.frame(inddto = sapply(c("2004-01-20", "2004-01-22", "2006-06-20", "2006-06-23", "2010-01-21",
                                       "2010-01-14", "2010-01-26", "2010-07-05", "2010-10-21", "2011-07-14",
                                       "2011-12-01", "2011-12-14", "2011-12-25", "2011-12-29"), as.Date),
                      uddto  = sapply(c("2004-01-20", "2004-01-23", "2006-06-20", "2006-06-23", "2010-01-20",
                                       "2010-01-26", "2010-02-10", "2010-07-05", "2010-10-29", "2011-07-16",
                                       "2011-12-14", "2011-12-25", "2011-12-29", "2012-01-16"), as.Date))
admData$pnr <- rep(1, dim(admData)[1])
admData$inddto <- as.Date(admData$inddto, origin="1970-01-01")
admData$uddto <- as.Date(admData$uddto, origin="1970-01-01")
library(heaven)
PPI <- read.table("../data/samplePPIData.csv", header=TRUE, sep=";")
PPI$eksd <- as.Date(PPI$eksd, format="%d/%m/%Y")
d <- dpp()
drugdb(d) <- PPI
admdb(d) <- admData

drug(d, "omeprazol") <- atc("A02BC02")
drug(d, "omeprazol") <- pack(c(10, 20, 40, 40),
                             min = c(10, 20, 40, 40),
                             max = c(20, 40, 60, 80),
                             def = c(10, 20, 40, 40))

period(d) <- sapply(c("1997-01-01", "2012-12-31"), as.Date)

maxdepot(d) <- 4000
out <- process(d)
plot(out)
#+END_SRC

#+RESULTS[<2016-11-28 11:28:39> 593c3dd58559e92e0369d635626bf6d33fa9c6b8]:
[[file:./drug-fig-ex-2.pdf]]

#+LABEL: fig:ex1-1
#+ATTR_LATEX: :width 1 \textwidth
file:./drug-fig-ex-2.pdf

*** Example: Omeprazol
 :PROPERTIES:
 :BEAMER_opt: shrink=20
 :END:

Plotting output with input: 
#+ATTR_LATEX: :options otherkeywords={}, deletekeywords={}
#+BEGIN_SRC R :exports code :results output   :session *R* :cache yes 
out1 <- process(d, keep_data = TRUE)
plot(out1, trace = TRUE)
#+END_SRC

#+RESULTS[<2016-11-30 14:34:46> e269fa0c6075e6082714cb6e5dbc6f571267cec0]:


#+BEGIN_SRC R :results graphics :file "./drug-fig-ex-3.pdf" :exports none  :session *R* :width 8 :height 6
admData <- data.frame(inddto = sapply(c("2004-01-20", "2004-01-22", "2006-06-20", "2006-06-23", "2010-01-21",
                                       "2010-01-14", "2010-01-26", "2010-07-05", "2010-10-21", "2011-07-14",
                                       "2011-12-01", "2011-12-14", "2011-12-25", "2011-12-29"), as.Date),
                      uddto  = sapply(c("2004-01-20", "2004-01-23", "2006-06-20", "2006-06-23", "2010-01-20",
                                       "2010-01-26", "2010-02-10", "2010-07-05", "2010-10-29", "2011-07-16",
                                       "2011-12-14", "2011-12-25", "2011-12-29", "2012-01-16"), as.Date))
admData$pnr <- rep(1, dim(admData)[1])
admData$inddto <- as.Date(admData$inddto, origin="1970-01-01")
admData$uddto <- as.Date(admData$uddto, origin="1970-01-01")
library(heaven)
PPI <- read.table("../data/samplePPIData.csv", header=TRUE, sep=";")
PPI$eksd <- as.Date(PPI$eksd, format="%d/%m/%Y")
d <- dpp()
drugdb(d) <- PPI
admdb(d) <- admData

drug(d, "omeprazol") <- atc("A02BC02")
drug(d, "omeprazol") <- pack(c(10, 20, 40, 40),
                             min = c(10, 20, 40, 40),
                             max = c(20, 40, 60, 80),
                             def = c(10, 20, 40, 40))

period(d) <- sapply(c("1997-01-01", "2012-12-31"), as.Date)

maxdepot(d) <- 4000
out1 <- process(d, keep_data = TRUE)
plot(out1, trace = TRUE)
#+END_SRC

#+RESULTS[<2016-11-28 11:28:39> 593c3dd58559e92e0369d635626bf6d33fa9c6b8]:
[[file:./drug-fig-ex-3.pdf]]

#+LABEL: fig:ex1-1
#+ATTR_LATEX: :width 1 \textwidth
file:./drug-fig-ex-3.pdf



*** 

**** Untitled column
    :PROPERTIES:
    :BEAMER_col: 0.1
    :END:

**** Untitled column
    :PROPERTIES:
    :BEAMER_col: 0.3
    :END:
Thank you


**** Untitled column
    :PROPERTIES:
    :BEAMER_col: 0.9
    :END:
#+LABEL: fig:1
#+ATTR_LATEX: :width 0.5\textwidth
[[file:./M9ipndpcE.png]]


* HEADER :noexport:

#+TITLE: Medicin Macro
#+SUBTITLE: A matemathical formulation of the algorithm, an efficient implementation and a new R interface
#+Author: Helene Charlotte Rytgaard
#+Latex_header:\institute{University of Copenhagen, Section of Biostatistics}
#+DATE: December 8, 2016
#+EMAIL: hely@sund.ku.dk
#+OPTIONS: H:3 num:t toc:nil \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t
#+OPTIONS: TeX:t LaTeX:t skip:nil d:t todo:t pri:nil tags:not-in-toc
#+INFOJS_OPT: view:nil toc:nil ltoc:t mouse:underline buttons:0 path:http://orgmode.org/org-info.js
#+startup: beamer
#+LaTeX_CLASS: beamer
#  #+LaTeX_HEADER: \titlegraphic{\includegraphics[width=3cm]{xx.jpeg}}
#  #+ LaTeX_class_options: [handout]
#+BEAMER_THEME: Berkeley [height=20pt]
#+LaTeX_class_options: [table] 
#+LaTeX_HEADER: \subtitle{}
#+LaTeX_HEADER: \setbeamertemplate{footline}[frame number]
#+LaTeX_HEADER: \setbeamertemplate{navigation symbols}{}
#+LATEX_HEADER: \RequirePackage{fancyvrb}
#+LATEX_HEADER: \RequirePackage{array}
#+LATEX_HEADER: \RequirePackage{multirow}
#+LATEX_HEADER: \DefineVerbatimEnvironment{verbatim}{Verbatim}{fontsize=\small,formatcom = {\color[rgb]{0.5,0,0}}}
#+LaTeX_HEADER:\newcommand{\EE}{\mathbb{E}}
#+LaTeX_HEADER:\newcommand{\one}{1}
#+LaTeX_HEADER:\newcommand{\VV}{\mathbb{V}}
#+LaTeX_HEADER:\newcommand{\PP}{\mbox{P}}
#+LaTeX_HEADER:\newcommand{\norm}{\mathcal{N}}
#+LaTeX_HEADER:\newcommand{\lag}{N}
#+LaTeX_HEADER:\newcommand{\str}{S}
#+LaTeX_HEADER:\newcommand{\smin}{s^{\min}}
#+LaTeX_HEADER:\newcommand{\smax}{s^{\max}}
#+LaTeX_HEADER:\newcommand{\styp}{s^{*}}
#+LaTeX_HEADER:\newcommand{\period}{[a,b]}
#+LaTeX_HEADER:\newcommand{\periodK}{\ensuremath{[T_k,T_{k+1})}}
#+LaTeX_HEADER:\newcommand{\K}{K}
#+LaTeX_HEADER:\newcommand{\kk}{k}
#+LaTeX_HEADER:\newcommand{\D}{D}
#+LaTeX_HEADER:\newcommand{\B}{B}
#+LaTeX_HEADER:\newcommand{\E}{E}
#+LaTeX_HEADER:\newcommand{\XX}{X}
#+LaTeX_HEADER:\newcommand{\LL}{L}
#+LaTeX_HEADER:\newcommand{\QQ}{Q}
#+LaTeX_HEADER:\newcommand{\Ru}{R}
#+LaTeX_HEADER:\newcommand{\GG}{G}
#+LaTeX_HEADER:\newcommand{\T}{T}
#+LaTeX_HEADER:\newcommand{\st}{s}
#+LaTeX_HEADER:\newcommand{\Nn}{N}
#+LaTeX_HEADER:\newcommand{\A}{A}
#+LaTeX_HEADER:\newcommand{\C}{C}
#+LaTeX_HEADER:\newcommand{\uu}{u}
#+LaTeX_HEADER:\newcommand{\vv}{v}
#+LaTeX_HEADER:\newcommand{\zz}{z}
#+LaTeX_HEADER:\newcommand{\ww}{w}
#+LaTeX_HEADER:\newcommand{\M}{M}
#+LaTeX_HEADER:\newcommand{\I}{I}
#+LaTeX_HEADER:\newcommand{\RR}{R}
#+PROPERTY: header-args session *R*
#+PROPERTY: header-args cache yes
